---
title: Zweck Hierarchie und mehr Instanzen Fähigkeit in ASP.net Core
author: rick-anderson
description: Erfahren Sie mehr über die Zeichen folgen Hierarchie und die mehr Instanzen Fähigkeit in Bezug auf die ASP.net Core Datenschutz-APIs.
ms.author: riande
ms.date: 10/14/2016
no-loc:
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: security/data-protection/consumer-apis/purpose-strings-multitenancy
ms.openlocfilehash: 4d442d3020c0d67b40ebd101442e5c84dcd4dbc6
ms.sourcegitcommit: 497be502426e9d90bb7d0401b1b9f74b6a384682
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/08/2020
ms.locfileid: "88022224"
---
# <a name="purpose-hierarchy-and-multi-tenancy-in-aspnet-core"></a><span data-ttu-id="884b5-103">Zweck Hierarchie und mehr Instanzen Fähigkeit in ASP.net Core</span><span class="sxs-lookup"><span data-stu-id="884b5-103">Purpose hierarchy and multi-tenancy in ASP.NET Core</span></span>

<span data-ttu-id="884b5-104">Da ein `IDataProtector` auch implizit eine ist `IDataProtectionProvider` , können-Zwecke miteinander verkettet werden.</span><span class="sxs-lookup"><span data-stu-id="884b5-104">Since an `IDataProtector` is also implicitly an `IDataProtectionProvider`, purposes can be chained together.</span></span> <span data-ttu-id="884b5-105">In diesem Sinne `provider.CreateProtector([ "purpose1", "purpose2" ])` entspricht `provider.CreateProtector("purpose1").CreateProtector("purpose2")` .</span><span class="sxs-lookup"><span data-stu-id="884b5-105">In this sense, `provider.CreateProtector([ "purpose1", "purpose2" ])` is equivalent to `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span></span>

<span data-ttu-id="884b5-106">Dies ermöglicht einige interessante hierarchische Beziehungen durch das Datenschutzsystem.</span><span class="sxs-lookup"><span data-stu-id="884b5-106">This allows for some interesting hierarchical relationships through the data protection system.</span></span> <span data-ttu-id="884b5-107">Im vorherigen Beispiel von " [fitoso. Messaging. securemessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose)" kann die securemessage-Komponente `provider.CreateProtector("Contoso.Messaging.SecureMessage")` einmal vorab aufrufen und das Ergebnis in einem privaten Feld Zwischenspeichern `_myProvider` .</span><span class="sxs-lookup"><span data-stu-id="884b5-107">In the earlier example of [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), the SecureMessage component can call `provider.CreateProtector("Contoso.Messaging.SecureMessage")` once up-front and cache the result into a private `_myProvider` field.</span></span> <span data-ttu-id="884b5-108">Zukünftige Schutzvorrichtungen können dann über Aufrufe von erstellt werden `_myProvider.CreateProtector("User: username")` , und diese Schutzvorrichtungen werden zum Sichern der einzelnen Nachrichten verwendet.</span><span class="sxs-lookup"><span data-stu-id="884b5-108">Future protectors can then be created via calls to `_myProvider.CreateProtector("User: username")`, and these protectors would be used for securing the individual messages.</span></span>

<span data-ttu-id="884b5-109">Dies kann auch gekippt werden.</span><span class="sxs-lookup"><span data-stu-id="884b5-109">This can also be flipped.</span></span> <span data-ttu-id="884b5-110">Stellen Sie sich eine einzige logische Anwendung vor, die mehrere Mandanten hostet (ein CMS erscheint vernünftig), und jeder Mandant kann mit einem eigenen Authentifizierungs-und Zustands Verwaltungssystem konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="884b5-110">Consider a single logical application which hosts multiple tenants (a CMS seems reasonable), and each tenant can be configured with its own authentication and state management system.</span></span> <span data-ttu-id="884b5-111">Die Anwendung "Umbrella" verfügt über einen einzigen Master Anbieter und ruft `provider.CreateProtector("Tenant 1")` und `provider.CreateProtector("Tenant 2")` auf, um jedem Mandanten einen eigenen isolierten Slice des Datenschutzsystems zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="884b5-111">The umbrella application has a single master provider, and it calls `provider.CreateProtector("Tenant 1")` and `provider.CreateProtector("Tenant 2")` to give each tenant its own isolated slice of the data protection system.</span></span> <span data-ttu-id="884b5-112">Die Mandanten können dann Ihre eigenen individuellen Schutzvorrichtungen basierend auf Ihren eigenen Anforderungen ableiten, aber unabhängig davon, wie schwierig Sie sind, können Sie keine Schutzvorrichtungen erstellen, die mit einem anderen Mandanten im System kollidieren.</span><span class="sxs-lookup"><span data-stu-id="884b5-112">The tenants could then derive their own individual protectors based on their own needs, but no matter how hard they try they cannot create protectors which collide with any other tenant in the system.</span></span> <span data-ttu-id="884b5-113">Grafisch dargestellt wird dies wie unten dargestellt.</span><span class="sxs-lookup"><span data-stu-id="884b5-113">Graphically, this is represented as below.</span></span>

![Mehr Instanzen Fähigkeit](purpose-strings-multitenancy/_static/purposes-multi-tenancy.png)

>[!WARNING]
> <span data-ttu-id="884b5-115">Dabei wird davon ausgegangen, dass die Anwendung steuert, welche APIs einzelnen Mandanten zur Verfügung stehen und dass Mandanten keinen beliebigen Code auf dem Server ausführen können.</span><span class="sxs-lookup"><span data-stu-id="884b5-115">This assumes the umbrella application controls which APIs are available to individual tenants and that tenants cannot execute arbitrary code on the server.</span></span> <span data-ttu-id="884b5-116">Wenn ein Mandant beliebigen Code ausführen kann, kann er eine private Reflektion durchführen, um die Isolations Garantien zu unterbrechen, oder er könnte einfach das Hauptschlüssel Material direkt lesen und die gewünschten Unterschlüssel ableiten.</span><span class="sxs-lookup"><span data-stu-id="884b5-116">If a tenant can execute arbitrary code, they could perform private reflection to break the isolation guarantees, or they could just read the master keying material directly and derive whatever subkeys they desire.</span></span>

<span data-ttu-id="884b5-117">Das Datenschutzsystem verwendet in seiner standardmäßigen Standardkonfiguration tatsächlich eine Art mehr Instanzen Fähigkeit.</span><span class="sxs-lookup"><span data-stu-id="884b5-117">The data protection system actually uses a sort of multi-tenancy in its default out-of-the-box configuration.</span></span> <span data-ttu-id="884b5-118">Standardmäßig wird das Masterschlüssel Material im Benutzerprofil Ordner des Arbeitsprozess Kontos (oder in der Registrierung für IIS-Anwendungs Pool Identitäten) gespeichert.</span><span class="sxs-lookup"><span data-stu-id="884b5-118">By default master keying material is stored in the worker process account's user profile folder (or the registry, for IIS application pool identities).</span></span> <span data-ttu-id="884b5-119">Es ist jedoch ziemlich üblich, ein einzelnes Konto zum Ausführen mehrerer Anwendungen zu verwenden. Daher würden alle diese Anwendungen das Hauptmaterial für die schlüsselfreigabe freigeben.</span><span class="sxs-lookup"><span data-stu-id="884b5-119">But it's actually fairly common to use a single account to run multiple applications, and thus all these applications would end up sharing the master keying material.</span></span> <span data-ttu-id="884b5-120">Um dieses Problem zu beheben, fügt das Datenschutzsystem automatisch einen eindeutigen Bezeichner für die Anwendung als erstes Element in der gesamten Ziel Kette ein.</span><span class="sxs-lookup"><span data-stu-id="884b5-120">To solve this, the data protection system automatically inserts a unique-per-application identifier as the first element in the overall purpose chain.</span></span> <span data-ttu-id="884b5-121">Dieser implizite Zweck dient dazu, [einzelne Anwendungen](xref:security/data-protection/configuration/overview#per-application-isolation) voneinander zu isolieren, indem jede Anwendung als eindeutiger Mandant innerhalb des Systems behandelt wird und der Erstellungs Prozess der Schutzvorrichtung mit der obigen Abbildung identisch aussieht.</span><span class="sxs-lookup"><span data-stu-id="884b5-121">This implicit purpose serves to [isolate individual applications](xref:security/data-protection/configuration/overview#per-application-isolation) from one another by effectively treating each application as a unique tenant within the system, and the protector creation process looks identical to the image above.</span></span>
